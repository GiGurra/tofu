# OS Notifications

Get notified when Claude sessions need attention.

## Overview

Tofu can send OS notifications when Claude sessions transition to states that require user attention (idle, awaiting permission, awaiting input). This is useful when running multiple sessions or working in a different window.

**Disabled by default** - run `tofu claude setup` to enable.

## Quick Setup

The easiest way to enable notifications:

```bash
tofu claude setup
```

This will:
1. Install Claude hooks for status tracking
2. Register the protocol handler (WSL/Windows) for clickable notifications
3. Ask if you want to enable notifications

You can check your setup status anytime:

```bash
tofu claude setup --check
```

## Manual Configuration

Alternatively, create `~/.tofu/config.json` manually:

```json
{
  "notifications": {
    "enabled": true,
    "transitions": [
      {"from": "*", "to": "idle"},
      {"from": "*", "to": "awaiting_permission"},
      {"from": "*", "to": "awaiting_input"},
      {"from": "*", "to": "exited"}
    ],
    "cooldown_seconds": 5
  }
}
```

### Options

| Field | Description | Default |
|-------|-------------|---------|
| `enabled` | Master switch for notifications | `false` |
| `transitions` | List of state transitions that trigger notifications | See below |
| `cooldown_seconds` | Minimum seconds between notifications per session | `5` |

### Transitions

Each transition rule has `from` and `to` fields. Use `*` as a wildcard to match any state.

**Default transitions:**
- `*` → `idle` - Claude finished processing
- `*` → `awaiting_permission` - Claude needs permission to proceed
- `*` → `awaiting_input` - Claude is asking a question
- `*` → `exited` - Session ended

**Available states:** `working`, `idle`, `awaiting_permission`, `awaiting_input`, `exited`

### Examples

Only notify when permission is needed:
```json
{
  "notifications": {
    "enabled": true,
    "transitions": [
      {"from": "*", "to": "awaiting_permission"}
    ]
  }
}
```

Notify on any state change from working:
```json
{
  "notifications": {
    "enabled": true,
    "transitions": [
      {"from": "working", "to": "*"}
    ]
  }
}
```

## Notification Content

Notifications display:
- **Title:** `Claude: <state>` (e.g., "Claude: Idle")
- **Body:** Session ID, project name, and conversation title/prompt

## Platform Support

| Platform | Status | Notifications | Clickable | Focus Method |
|----------|--------|---------------|-----------|--------------|
| macOS | ✅ Tested | `terminal-notifier` or osascript | ✅ Yes | iTerm2/Terminal.app AppleScript |
| WSL | ✅ Tested | PowerShell toast notifications | ✅ Yes | Windows Terminal focus* |
| Linux (native) | ⚠️ Untested | `dunstify` or `notify-send` | With dunstify | xdotool |
| Windows (native) | ❌ Not implemented | - | - | - |

**Notes:**
- \* WSL focus works best when the target session is the active tab. If it's in a background tab, clicking the notification will detach that tab and open a new window with the session.
- Native Linux support uses standard tools (`dunstify`, `notify-send`, `xdotool`) but has not been tested on actual hardware. Feedback welcome!

## Prerequisites

- **tmux** - Required for session management (checked by `tofu claude setup`)

## Clickable Notifications

Notifications are clickable on all supported platforms. Clicking a notification will focus the terminal window running that session.

### macOS

Requires `terminal-notifier` for clickable notifications:

```bash
brew install terminal-notifier
```

The setup command will offer to install this automatically if Homebrew is available.

### Linux (native)

For clickable notifications, install `dunstify` (part of dunst notification daemon):

```bash
sudo apt install dunst
```

For window focus when clicking notifications, install `xdotool`:

```bash
sudo apt install xdotool
```

Without these, notifications still work via `notify-send` but won't be clickable.

### WSL

On WSL, notifications use Windows Toast notifications via PowerShell. Clicking them will focus the Windows Terminal window. This requires the `tofu://` protocol handler to be registered, which `tofu claude setup` handles automatically.

**Note:** If the target session is in a background tab, clicking the notification will detach that tab from tmux and open a new Windows Terminal window with the session attached.

If clicking doesn't work:
1. Run `tofu claude setup --check` to verify protocol handler is registered
2. Run `tofu claude setup --force` to re-register the handler

## Troubleshooting

### Notifications not appearing

1. Run `tofu claude setup --check` to verify everything is configured
2. Check that `~/.tofu/config.json` has `"enabled": true`
3. Check that the session state transition matches your configured rules

### WSL-specific issues

WSL requires PowerShell access for notifications. Tofu automatically uses PowerShell toast notifications when running in WSL. If notifications still don't work:

1. Verify PowerShell is accessible: `ls /mnt/c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe`
2. Check Windows notification settings allow toast notifications
3. Run `tofu claude setup` to ensure hooks and protocol handler are configured

### Cooldown

If you're not seeing notifications for rapid state changes, it's likely the cooldown. Notifications are rate-limited per session to prevent spam. Adjust `cooldown_seconds` if needed.
